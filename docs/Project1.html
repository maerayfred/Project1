<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Project1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Project1</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="data-processing" class="level2">
<h2 class="anchored" data-anchor-id="data-processing">Data Processing</h2>
<section id="in-this-step-we-create-the-url-string-starting-with-the-base-url-and-incorporating-our-default-variables-from-get_vals.-we-set-a-default-geography-of-state-10-delaware-to-prevent-unintended-large-api-calls." class="level3">
<h3 class="anchored" data-anchor-id="in-this-step-we-create-the-url-string-starting-with-the-base-url-and-incorporating-our-default-variables-from-get_vals.-we-set-a-default-geography-of-state-10-delaware-to-prevent-unintended-large-api-calls.">In this step, we create the URL string, starting with the base URL and incorporating our default variables from get_vals. We set a default geography of state 10 (Delaware) to prevent unintended large API calls.</h3>
<section id="load-functions-created-for-url-creation-and-tibble-creation-from-url-response." class="level4">
<h4 class="anchored" data-anchor-id="load-functions-created-for-url-creation-and-tibble-creation-from-url-response.">Load functions created for URL creation and tibble creation from URL response.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter()  masks stats::filter()
✖ purrr::flatten() masks jsonlite::flatten()
✖ dplyr::lag()     masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>census_url <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">year=</span><span class="st">"2022"</span>, <span class="at">get_vals=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>), <span class="at">get_vals_subset=</span><span class="cn">NULL</span>, <span class="at">for_val=</span><span class="st">"state:10"</span>) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Builds the URL, assumes all values are valid and/or validation is done outside of this function</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Some defaults are provided, just to ensure a large API call URL isn't constructed on accident</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  BASE_URL <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://api.census.gov/data/{year}/acs/acs1/pums"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  get_vals_str <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((vals <span class="ot">&lt;-</span> <span class="fu">paste</span>(get_vals, <span class="at">collapse=</span><span class="st">","</span>)) <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">glue</span>(<span class="st">"get={vals}"</span>), <span class="st">""</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  get_vals_subset_str <span class="ot">&lt;-</span> <span class="fu">paste</span>(get_vals_subset, <span class="at">collapse=</span><span class="st">"&amp;"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  for_str <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(for_val <span class="sc">!=</span> <span class="st">""</span>, <span class="fu">glue</span>(<span class="st">"for={for_val}"</span>), <span class="st">""</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  suffix_list <span class="ot">&lt;-</span> <span class="fu">c</span>(get_vals_str, get_vals_subset_str, for_str)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  suffix <span class="ot">&lt;-</span> <span class="fu">paste</span>(suffix_list[suffix_list <span class="sc">!=</span> <span class="st">""</span>], <span class="at">collapse=</span><span class="st">"&amp;"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">glue</span>(<span class="st">"{BASE_URL}?{suffix}"</span>))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>census_tibble <span class="ot">&lt;-</span> <span class="cf">function</span>(URL) {</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Given a census_url, this function will return a tibble of the data</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  id_info <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(URL)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Creating a tibble to view API information</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(id_info<span class="sc">$</span>content))</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  parsed_tibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(parsed[<span class="sc">-</span><span class="dv">1</span>,])</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(parsed_tibble) <span class="ot">&lt;-</span> parsed[<span class="dv">1</span>,]</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (parsed_tibble)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-the-test-file-that-shows-these-usages." class="level4">
<h4 class="anchored" data-anchor-id="load-the-test-file-that-shows-these-usages.">Load the test file that shows these usages.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/census_query.R"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>test_1_cq <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test default</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  URL <span class="ot">&lt;-</span> <span class="fu">census_url</span>()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (URL)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>test_2_cq <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test omissions of variables</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  URL <span class="ot">&lt;-</span> <span class="fu">census_url</span>(<span class="at">get_vals=</span><span class="cn">NULL</span>, <span class="at">get_vals_subset=</span><span class="cn">NULL</span>, <span class="at">for_val=</span><span class="cn">NULL</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (URL)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>test_3_cq <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test providing values use, no validations</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  URL <span class="ot">&lt;-</span> <span class="fu">census_url</span>(</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">year=</span><span class="dv">2021</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">get_vals =</span> <span class="fu">c</span>(<span class="st">"HISPEED"</span>, <span class="st">"PWGTP"</span>),</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">get_vals_subset =</span> <span class="fu">c</span>(<span class="st">"AGEP=00"</span>, <span class="st">"SEX=2"</span>, <span class="st">"GRPIP=30:32"</span>),</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">for_val =</span> <span class="st">"region:1"</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (URL)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>test_4_cq <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test using URL to get the same data in a tibble</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  URL <span class="ot">&lt;-</span> <span class="fu">test_3_cq</span>()</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">census_tibble</span>(URL))</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calls census URL with no input parameters (default)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_1_cq</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>https://api.census.gov/data/2022/acs/acs1/pums?get=AGEP,PWGTP,SEX&amp;for=state:10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calls census URL with overridden NULL parameters (base URL returned)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_2_cq</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>https://api.census.gov/data/2022/acs/acs1/pums?</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calls census URL with fairly specific URL parameters given of different forms</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_3_cq</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>https://api.census.gov/data/2021/acs/acs1/pums?get=HISPEED,PWGTP&amp;AGEP=00&amp;SEX=2&amp;GRPIP=30:32&amp;for=region:1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gets the tibble from the test 3 URL</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_4_cq</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
`.name_repair` is omitted as of tibble 2.0.0.
ℹ Using compatibility `.name_repair`.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 6
   HISPEED PWGTP AGEP  SEX   GRPIP region
   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 
 1 1       237   0     2     31    1     
 2 2       315   0     2     32    1     
 3 2       190   0     2     32    1     
 4 0       239   0     2     32    1     
 5 1       118   0     2     31    1     
 6 1       233   0     2     32    1     
 7 1       234   0     2     32    1     
 8 1       215   0     2     31    1     
 9 1       112   0     2     31    1     
10 1       65    0     2     32    1     
# ℹ 23 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="were-creating-a-function-to-access-api-data-allowing-the-year-to-change-with-a-default-of-2022-along-with-a-list-of-valid-variables-for-the-pums-api.-were-accessing-all-valid-api-variables-and-subsetting-them-according-to-project-instructions.-we-also-create-a-function-to-check-if-the-variables-in-the-subset-are-numeric-or-character." class="level3">
<h3 class="anchored" data-anchor-id="were-creating-a-function-to-access-api-data-allowing-the-year-to-change-with-a-default-of-2022-along-with-a-list-of-valid-variables-for-the-pums-api.-were-accessing-all-valid-api-variables-and-subsetting-them-according-to-project-instructions.-we-also-create-a-function-to-check-if-the-variables-in-the-subset-are-numeric-or-character.">We’re creating a function to access API data, allowing the year to change with a default of 2022, along with a list of valid variables for the PUMS API. We’re accessing all valid API variables and subsetting them according to project instructions. We also create a function to check if the variables in the subset are numeric or character.</h3>
<section id="load-functions-for-getting-census-variables-data." class="level4">
<h4 class="anchored" data-anchor-id="load-functions-for-getting-census-variables-data.">Load functions for getting census variables data.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"glue"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"jsonlite"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"httr"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>get_variable_list <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">year=</span><span class="st">"2022"</span>, <span class="at">subset=</span><span class="cn">NULL</span>) {</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the full variable list for the given year, with option to filter the list down to a subset</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  URL_VARIABLES <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://api.census.gov/data/{year}/acs/acs1/pums/variables.json"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  var_info <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(URL_VARIABLES)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  var_info_parsed <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(var_info<span class="sc">$</span>content))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  var_info_tibble <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(var_info_parsed)<span class="sc">$</span>variables</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(subset)) {</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(var_info_tibble)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  var_data <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (var <span class="cf">in</span> subset) {</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    var_data[var] <span class="ot">&lt;-</span> var_info_tibble[var]</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(var_data)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>is_numeric_variable <span class="ot">&lt;-</span> <span class="cf">function</span>(var, var_info_tibble) {</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check if a value is numeric - meaning range is provided and or it is a specific named date variable</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var_info_tibble[[var]]<span class="sc">$</span>values<span class="sc">$</span>range) <span class="sc">|</span> var <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>)) {</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>get_valid_variable_values <span class="ot">&lt;-</span> <span class="cf">function</span>(var, var_info_tibble) {</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get an output to see the valid variables that can be had (the items and the range)</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># items are just placed into the list, the range pulls the named items of min and max</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  var_range <span class="ot">&lt;-</span> var_info_tibble[[var]]<span class="sc">$</span>values<span class="sc">$</span>range</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  var_item <span class="ot">&lt;-</span> var_info_tibble[[var]]<span class="sc">$</span>values<span class="sc">$</span>item</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var_item)) {</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <span class="fu">c</span>(ret, <span class="fu">names</span>(var_item))</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(var_range)) {</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>    min <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(var_range<span class="sc">$</span>min)</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    max <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(var_range<span class="sc">$</span>max)</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <span class="fu">c</span>(ret, <span class="fu">c</span>(<span class="at">min=</span>min,<span class="at">max=</span>max))</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (ret)</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>is_valid_variable_value <span class="ot">&lt;-</span> <span class="cf">function</span>(val, var, var_info_tibble) {</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># give a value for a variable, check if it is valid</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>  valid_values <span class="ot">&lt;-</span> <span class="fu">get_valid_variable_values</span>(var, var_info_tibble)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (val <span class="sc">%in%</span> valid_values) {</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if names contains min and max both, there was a range provided</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"min"</span> <span class="sc">%in%</span> <span class="fu">names</span>(valid_values) <span class="sc">&amp;</span> <span class="st">"max"</span> <span class="sc">%in%</span> <span class="fu">names</span>(valid_values)) {</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    min <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(valid_values[<span class="st">"min"</span>])</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    max <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(valid_values[<span class="st">"max"</span>])</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    num_val <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(val)</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (num_val <span class="sc">&gt;=</span> min <span class="sc">&amp;</span> num_val <span class="sc">&lt;=</span> max)</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-the-test-file-that-shows-these-usages.-1" class="level4">
<h4 class="anchored" data-anchor-id="load-the-test-file-that-shows-these-usages.-1">Load the test file that shows these usages.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/census_variables.R"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>test_1_cv <span class="ot">&lt;-</span> <span class="cf">function</span> () {</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test default get all</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  var_list <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (var_list)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>test_2_cv <span class="ot">&lt;-</span> <span class="cf">function</span> () {</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test get specific</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  var_list <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">subset=</span><span class="st">"PWGTP"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (var_list)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>test_3_cv <span class="ot">&lt;-</span> <span class="cf">function</span> () {</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test if a variable is numeric or not from all the desired variables</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  all_var_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"GASP"</span>, <span class="st">"GRPIP"</span>, <span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>, <span class="st">"JWMNP"</span>, <span class="st">"SEX"</span>, <span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"HISPEED"</span>, <span class="st">"JWTRNS"</span>, <span class="st">"SCH"</span>, <span class="st">"SCHL"</span>, <span class="st">"REGION"</span>, <span class="st">"DIVISION"</span>, <span class="st">"ST"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  numeric_var_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"GASP"</span>, <span class="st">"GRPIP"</span>, <span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>, <span class="st">"JWMNP"</span>, <span class="st">"PWGTP"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  categorical_var_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"HISPEED"</span>, <span class="st">"JWTRNS"</span>, <span class="st">"SCH"</span>, <span class="st">"SCHL"</span>, <span class="st">"SEX"</span>, <span class="st">"REGION"</span>, <span class="st">"DIVISION"</span>, <span class="st">"ST"</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  filtered_var_list <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">subset=</span>all_var_list)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (var <span class="cf">in</span> all_var_list) {</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(paste(var, ifelse(is_numeric_variable(var, filtered_var_list), "numeric", "categorical")), sep=" ")</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_numeric_variable</span>(var, filtered_var_list)) {</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span>var <span class="sc">%in%</span> numeric_var_list) {</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span>var <span class="sc">%in%</span> categorical_var_list) {</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>test_4_cv <span class="ot">&lt;-</span> <span class="cf">function</span> () {</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test get valid variable values</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  variable_list <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">subset=</span><span class="fu">c</span>(<span class="st">"SEX"</span>, <span class="st">"PWGTP"</span>, <span class="st">"GRPIP"</span>))</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  cat_only <span class="ot">&lt;-</span> <span class="fu">get_valid_variable_values</span>(<span class="st">"SEX"</span>, variable_list)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>  num_only <span class="ot">&lt;-</span> <span class="fu">get_valid_variable_values</span>(<span class="st">"PWGTP"</span>, variable_list)</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  both <span class="ot">&lt;-</span> <span class="fu">get_valid_variable_values</span>(<span class="st">"GRPIP"</span>, variable_list)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span>(<span class="at">cat_only_SEX=</span>cat_only, <span class="at">num_only_PWGTP=</span>num_only, <span class="at">both_GRPIP=</span>both))</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>test_5_cv <span class="ot">&lt;-</span> <span class="cf">function</span> () {</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test is valid variable value</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  variable_list <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="at">subset=</span><span class="fu">c</span>(<span class="st">"GRPIP"</span>, <span class="st">"AGEP"</span>, <span class="st">"SEX"</span>))</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"GRPIP"</span>)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">get_valid_variable_values</span>(<span class="st">"GRPIP"</span>, variable_list))</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># valid GRPIP</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (val <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"101"</span>, <span class="st">"1"</span>, <span class="st">"100"</span>, <span class="st">"45"</span>)) {</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is_valid_variable_value</span>(val, <span class="st">"GRPIP"</span>, variable_list)) {</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invalid GRPIP</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (val <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"102"</span>, <span class="st">"00"</span>)) {</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_valid_variable_value</span>(val, <span class="st">"GRPIP"</span>, variable_list)) {</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"AGEP"</span>)</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">get_valid_variable_values</span>(<span class="st">"AGEP"</span>, variable_list))</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># valid AGEP</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (val <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"00"</span>, <span class="st">"1"</span>, <span class="st">"99"</span>, <span class="st">"45"</span>)) {</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is_valid_variable_value</span>(val, <span class="st">"AGEP"</span>, variable_list)) {</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(val)</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invalid AGEP</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (val <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"100"</span>, <span class="st">"0"</span>)) {</span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_valid_variable_value</span>(val, <span class="st">"AGEP"</span>, variable_list)) {</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"SEX"</span>)</span>
<span id="cb15-82"><a href="#cb15-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">get_valid_variable_values</span>(<span class="st">"SEX"</span>, variable_list))</span>
<span id="cb15-83"><a href="#cb15-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># valid SEX</span></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (val <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>)) {</span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is_valid_variable_value</span>(val, <span class="st">"SEX"</span>, variable_list)) {</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># invalid SEX</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (val <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"3"</span>)) {</span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_valid_variable_value</span>(val, <span class="st">"SEX"</span>, variable_list)) {</span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a portion of getting all variables - will be of a list of 512 items</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">tail</span>(<span class="fu">test_1_cv</span>(), <span class="dv">3</span>), <span class="at">max.level=</span><span class="dv">4</span>, <span class="at">list.len=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ TEL :List of 6
  ..$ label           : chr "Telephone service"
  ..$ predicateType   : chr "int"
  ..$ group           : chr "N/A"
  ..$ limit           : int 0
  ..$ suggested-weight: chr "WGTP"
  ..$ values          :List of 1
  .. ..$ item:List of 3
  .. .. ..$ 1: chr "Yes"
  .. .. ..$ 0: chr "N/A (GQ/vacant)"
  .. .. ..$ 2: chr "No"
 $ TEN :List of 6
  ..$ label           : chr "Tenure"
  ..$ predicateType   : chr "int"
  ..$ group           : chr "N/A"
  ..$ limit           : int 0
  ..$ suggested-weight: chr "WGTP"
  ..$ values          :List of 1
  .. ..$ item:List of 5
  .. .. ..$ 1: chr "Owned with mortgage or loan (include home equity loans)"
  .. .. ..$ 0: chr "N/A  (GQ/vacant)"
  .. .. ..$ 4: chr "Occupied without payment of rent"
  .. .. ..$ 3: chr "Rented"
  .. .. ..$ 2: chr "Owned Free And Clear"
 $ MLPJ:List of 6
  ..$ label           : chr "Served World War II (December 1941 - December 1946)"
  ..$ predicateType   : chr "int"
  ..$ group           : chr "N/A"
  ..$ limit           : int 0
  ..$ suggested-weight: chr "PWGTP"
  ..$ values          :List of 1
  .. ..$ item:List of 3
  .. .. ..$ 1 : chr "Served This Period"
  .. .. ..$ 0 : chr "Did not serve this period"
  .. .. ..$ -1: chr "N/A (Less than 17 years old/no active duty)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a subset of this list, in this case 1 item - this one is a post-filter of the full 512.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">test_2_cv</span>(), <span class="at">max.level =</span> <span class="dv">4</span>, <span class="at">list.len =</span> <span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ PWGTP:List of 6
  ..$ label        : chr "PUMS person weight"
  ..$ predicateType: chr "int"
  ..$ group        : chr "N/A"
  ..$ limit        : int 0
  ..$ is-weight    : logi TRUE
  ..$ values       :List of 1
  .. ..$ range:'data.frame':    1 obs. of  3 variables:
  .. .. ..$ min        : chr "1"
  .. .. ..$ max        : chr "9999"
  .. .. ..$ description: chr "Continuous values of PWGTP"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run through every iteration of expected values for what is numeric and what is categorical.</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Would return False if it encountered an expectation mismatch.</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_3_cv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show output of getting the variables allowed values. Shows all 3 versions.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># One that is only categorical, one that is only numerical, and one that is mixed.</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_4_cv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$cat_only_SEX
[1] "1" "2"

$num_only_PWGTP
 min  max 
   1 9999 

$both_GRPIP
              min   max 
  "0" "101"   "1" "100" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Goes through valid and invalid combinations. Will return True if expectation matches.</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Also prints as it is going, to show the expectations from the variable list to what is being tested.</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">test_5_cv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "GRPIP"
              min   max 
  "0" "101"   "1" "100" 
[1] "AGEP"
      min  max 
"00"  "1" "99" 
[1] "SEX"
[1] "1" "2"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="were-creating-a-function-that-matches-valid-variables-with-their-corresponding-numeric-ranges-and-character-items." class="level3">
<h3 class="anchored" data-anchor-id="were-creating-a-function-that-matches-valid-variables-with-their-corresponding-numeric-ranges-and-character-items.">We’re creating a function that matches valid variables with their corresponding numeric ranges and character items.</h3>
<section id="load-functions-used-for-input-validation." class="level4">
<h4 class="anchored" data-anchor-id="load-functions-used-for-input-validation.">Load functions used for input validation.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>is_valid_variable_input <span class="ot">&lt;-</span> <span class="cf">function</span>(given_list, valid_list, <span class="at">sep=</span><span class="st">"="</span>, <span class="at">with_delim=</span><span class="cn">FALSE</span>) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Checks if the given list of variables is valid, meaning each item in the list is found in the valid list</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># left_most side of the variable is exactly within the valid list</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># take the string element and split it based on the delimiter - taking the first item</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if with_delim is true, then take the portion up to and including the delimiter</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  strip_value <span class="ot">&lt;-</span> <span class="cf">function</span>(element) {</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (with_delim) {</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">substr</span>(element, <span class="dv">1</span>, <span class="fu">regexpr</span>(sep, element)))</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">strsplit</span>(element, sep)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># does it match any of the items in the valid list</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># all the items must match an item in the valid list</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ^ ensures it's the start of the string and $ ensures it's the end of the string, so must be hard match to the valid list</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">sapply</span>(given_list, <span class="cf">function</span>(x) <span class="fu">any</span>(<span class="fu">grepl</span>(<span class="fu">paste0</span>(<span class="st">"^"</span>, <span class="fu">strip_value</span>(x), <span class="st">"$"</span>), valid_list))))) {</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (<span class="cn">FALSE</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-tests-on-the-validation-to-show-usages." class="level4">
<h4 class="anchored" data-anchor-id="load-tests-on-the-validation-to-show-usages.">Load tests on the validation to show usages.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/input_validation.R"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>test_1_iv <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test valid default = delim</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  valid_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  valid_given_lists <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AGEP"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"AGEP=abc"</span>, <span class="st">"PWGTP=123"</span>, <span class="st">"SEX="</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (valid_given_list <span class="cf">in</span> valid_given_lists) {</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is_valid_variable_input</span>(valid_given_list, valid_list)) {</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>test_2_iv <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test valid alternate : delim</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  valid_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  valid_given_lists <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AGEP"</span>,</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>),</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"AGEP:abc"</span>, <span class="st">"PWGTP:123"</span>, <span class="st">"SEX:"</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (valid_given_list <span class="cf">in</span> valid_given_lists) {</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is_valid_variable_input</span>(valid_given_list, valid_list, <span class="at">sep=</span><span class="st">":"</span>)) {</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>test_3_iv <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test valid alternate : delim and including the delim in the match</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>  valid_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state:"</span>, <span class="st">"division:"</span>, <span class="st">"region:"</span>)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>  valid_given_lists <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state:"</span>,</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"state:"</span>, <span class="st">"division:5"</span>),</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"state:"</span>, <span class="st">"division:"</span>, <span class="st">"region:"</span>),</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"state:abc"</span>, <span class="st">"division:123"</span>, <span class="st">"region:"</span>)</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (valid_given_list <span class="cf">in</span> valid_given_lists) {</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is_valid_variable_input</span>(valid_given_list, valid_list, <span class="at">sep=</span><span class="st">":"</span>, <span class="at">with_delim =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>test_4_iv <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test invalid default = delim</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>  valid_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>  invalid_given_lists <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AGE"</span>,</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AGEPa"</span>,</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SAX=1"</span>),</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP:1"</span>)</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (invalid_given_list <span class="cf">in</span> invalid_given_lists) {</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_valid_variable_input</span>(invalid_given_list, valid_list)) {</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>test_5_iv <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test invalid alternate : delim</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>  valid_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>)</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>  invalid_given_lists <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AGE"</span>,</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AGEPa"</span>,</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SAX:1"</span>),</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP=1"</span>)</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (invalid_given_list <span class="cf">in</span> invalid_given_lists) {</span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_valid_variable_input</span>(invalid_given_list, valid_list, <span class="at">sep=</span><span class="st">":"</span>)) {</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>test_6_iv <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test invalid alternate : delim and including the delim in the match</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>  valid_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state:"</span>, <span class="st">"division:"</span>, <span class="st">"region:"</span>)</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>  invalid_given_lists <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">"state"</span>,</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"state:"</span>, <span class="st">"division=5"</span>),</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"state:"</span>, <span class="st">"division:"</span>, <span class="st">"region"</span>),</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"state:abc"</span>, <span class="st">"division:123"</span>, <span class="st">"ST:1"</span>)</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (invalid_given_list <span class="cf">in</span> invalid_given_lists) {</span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_valid_variable_input</span>(invalid_given_list, valid_list, <span class="at">sep=</span><span class="st">":"</span>, <span class="at">with_delim =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="cn">TRUE</span>)</span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks valid defaults. Basically just prefix matching and delimiter of `=`</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_1_iv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks valid, but with different delimiter.</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_2_iv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks valid, but different delimiter and prefix must include delimiter.</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_3_iv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks invalid, must be found as not valid because of violations of prefix.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_4_iv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks invalid, alternate delimiter.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_5_iv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checks invalid, delimiter included.</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_6_iv</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="were-taking-the-output-tibble-from-the-built-url-and-doing-the-data-processing-on-it-to-convert-column-types-and-fix-things-based-on-variable-api-data.-were-processing-the-time-variables-by-separating-the-intervals-updating-morningevening-abbreviations-for-usability-and-calculating-the-midpoint-to-derive-a-single-time-point." class="level3">
<h3 class="anchored" data-anchor-id="were-taking-the-output-tibble-from-the-built-url-and-doing-the-data-processing-on-it-to-convert-column-types-and-fix-things-based-on-variable-api-data.-were-processing-the-time-variables-by-separating-the-intervals-updating-morningevening-abbreviations-for-usability-and-calculating-the-midpoint-to-derive-a-single-time-point.">We’re taking the output tibble from the built URL and doing the data processing on it to convert column types and fix things based on variable API data. We’re processing the time variables by separating the intervals, updating morning/evening abbreviations for usability, and calculating the midpoint to derive a single time point.</h3>
<section id="load-the-functions-used-to-process-the-output-tibble-from-census-data." class="level4">
<h4 class="anchored" data-anchor-id="load-the-functions-used-to-process-the-output-tibble-from-census-data.">Load the functions used to process the output tibble from census data.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>fix_time_interval_categories <span class="ot">&lt;-</span> <span class="cf">function</span>(item, value_list) {</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># takes time intervals of the format "1:00 a.m. to 1:04 a.m."</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># converts to midpoint "1:02:00"</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  sorted_item <span class="ot">&lt;-</span> item[<span class="fu">sort</span>(<span class="fu">names</span>(item))]</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  item_values <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="fu">as.data.frame</span>(sorted_item), <span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to=</span><span class="cn">NULL</span>, <span class="at">values_to=</span><span class="st">"time_intervals"</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  item_df <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(<span class="fu">as.data.frame</span>(item_values), <span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to=</span><span class="cn">NULL</span>, <span class="at">values_to=</span><span class="st">"time_intervals"</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  item_df_transformed <span class="ot">&lt;-</span> item_df[<span class="sc">-</span><span class="dv">1</span>,] <span class="sc">|&gt;</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_wider_delim</span>(<span class="at">cols=</span><span class="st">"time_intervals"</span>, <span class="at">delim=</span><span class="st">" to "</span>, <span class="at">names=</span><span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"right"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">left =</span> <span class="fu">gsub</span>(<span class="st">"a.m."</span>, <span class="st">"AM"</span>, <span class="fu">gsub</span>(<span class="st">"p.m."</span>, <span class="st">"PM"</span>, left)),</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">right =</span> <span class="fu">gsub</span>(<span class="st">"a.m."</span>, <span class="st">"AM"</span>, <span class="fu">gsub</span>(<span class="st">"p.m."</span>, <span class="st">"PM"</span>, right))) <span class="sc">|&gt;</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">left =</span> <span class="fu">parse_date_time</span>(left, <span class="at">orders =</span> <span class="st">"I:M p"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>),</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">right =</span> <span class="fu">parse_date_time</span>(right, <span class="at">orders =</span> <span class="st">"I:M p"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">midpoint =</span> <span class="fu">format</span>(left <span class="sc">+</span> (right <span class="sc">-</span> left)<span class="sc">/</span><span class="dv">2</span>, <span class="st">"%H:%M:%S"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_wider_delim</span>(<span class="at">cols=</span><span class="st">"midpoint"</span>, <span class="at">delim=</span><span class="st">":"</span>, <span class="at">names=</span><span class="fu">c</span>(<span class="st">"hour"</span>, <span class="st">"minute"</span>, <span class="st">"second"</span>), <span class="at">cols_remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hour_value =</span> <span class="fu">as.numeric</span>(hour) <span class="sc">+</span> <span class="fu">as.numeric</span>(minute)<span class="sc">/</span><span class="dv">60</span> <span class="sc">+</span> <span class="fu">as.numeric</span>(second)<span class="sc">/</span><span class="dv">3600</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"midpoint"</span>, <span class="st">"hour_value"</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>  value_map <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  mid_map <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (value <span class="cf">in</span> value_list) {</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (value <span class="sc">==</span> <span class="st">"0"</span>) {</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>      value_map <span class="ot">&lt;-</span> <span class="fu">c</span>(value_map, <span class="st">"NA"</span>)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>      mid_map <span class="ot">&lt;-</span> <span class="fu">c</span>(mid_map, <span class="st">"NA"</span>)</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    value_map <span class="ot">&lt;-</span> <span class="fu">c</span>(value_map, item_df_transformed<span class="sc">$</span>hour_value[<span class="fu">as.numeric</span>(value)])</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    mid_map <span class="ot">&lt;-</span> <span class="fu">c</span>(mid_map, item_df_transformed<span class="sc">$</span>midpoint[<span class="fu">as.numeric</span>(value)])</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">value_list=</span>value_map, <span class="at">midpoints=</span>mid_map))</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>convert_columns_to_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(tibble, numeric_item_list, <span class="at">exclude_list=</span><span class="cn">NULL</span>) {</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>  tibble <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(numeric_item_list[<span class="sc">!</span>numeric_item_list <span class="sc">%in%</span> exclude_list]), as.numeric))</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (tibble)</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>remove_categorical_row_items_in_numeric <span class="ot">&lt;-</span> <span class="cf">function</span>(tibble, variable_info) {</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># takes a tibble and removes rows where the numeric column is not in the range given for the variable</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>  numeric_columns <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(numeric_columns)) {</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the min and max range for the current column from variable_info</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>    min_val <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(variable_info[[col]]<span class="sc">$</span>values<span class="sc">$</span>range<span class="sc">$</span>min)</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>    max_val <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(variable_info[[col]]<span class="sc">$</span>values<span class="sc">$</span>range<span class="sc">$</span>max)</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter the tibble rows based on the min and max values for this column</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>    tibble <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(col) <span class="sc">&gt;=</span> min_val <span class="sc">&amp;</span> <span class="sc">!!</span><span class="fu">sym</span>(col) <span class="sc">&lt;=</span> max_val)</span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (tibble)</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>convert_categorical_to_factor <span class="ot">&lt;-</span> <span class="cf">function</span>(tibble, variable_info) {</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># takes the character columns in the tibble and converts them to the factors in the variable list given</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># does some specific treatment of JWAP, JWDP, state, region, division - particular to census data</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>  character_columns <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">where</span>(is.character))</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(character_columns)) {</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>col <span class="sc">%in%</span> <span class="fu">names</span>(variable_info) <span class="sc">&amp;</span> <span class="sc">!</span>col <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"region"</span>, <span class="st">"division"</span>)) {</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>    col_var <span class="ot">&lt;-</span> col</span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>    col_var <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(col <span class="sc">==</span> <span class="st">"state"</span>, <span class="st">"ST"</span>, col_var)</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>    col_var <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(col <span class="sc">==</span> <span class="st">"region"</span>, <span class="st">"REGION"</span>, col_var)</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>    col_var <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(col <span class="sc">==</span> <span class="st">"division"</span>, <span class="st">"DIVISION"</span>, col_var)</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the item values for the current column from variable_info</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>    item_values <span class="ot">&lt;-</span> variable_info[[col_var]]<span class="sc">$</span>values<span class="sc">$</span>item</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sort the items based on names in reverse order to use labels later</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>    item_values <span class="ot">&lt;-</span> item_values[<span class="fu">order</span>(<span class="fu">names</span>(item_values))]</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># some have 01, 02, etc. but are placed in the lists as 1, 2, etc.</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(item_values) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">as.integer</span>(<span class="fu">names</span>(item_values)))</span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the column to a factor based on the item values</span></span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>    tibble <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(col) <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(<span class="sc">!!</span><span class="fu">sym</span>(col), <span class="at">levels=</span><span class="fu">names</span>(item_values), <span class="at">labels=</span>item_values))</span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (tibble)</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-and-example-output-of-post-processing." class="level4">
<h4 class="anchored" data-anchor-id="test-and-example-output-of-post-processing.">Test and example output of post processing.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/census_query.R"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/census_variables.R"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/post_processing.R"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>test_1_pp <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test the time value conversions for the 2 columns JWAP and JWDP</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">census_tibble</span>(<span class="fu">census_url</span>(<span class="at">year=</span><span class="st">"2022"</span>, <span class="at">get_vals=</span><span class="fu">c</span>(<span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>), <span class="at">for_val=</span><span class="st">"state:10"</span>))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lot of duplicate rows - get the unique ones</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">distinct</span>(<span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  var_filtered <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="st">"2022"</span>, <span class="fu">c</span>(<span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>))</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  fixed_JWAP <span class="ot">&lt;-</span> <span class="fu">fix_time_interval_categories</span>(var_filtered<span class="sc">$</span>JWAP<span class="sc">$</span>values<span class="sc">$</span>item, data<span class="sc">$</span>JWAP)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  fixed_JWDP <span class="ot">&lt;-</span> <span class="fu">fix_time_interval_categories</span>(var_filtered<span class="sc">$</span>JWDP<span class="sc">$</span>values<span class="sc">$</span>item, data<span class="sc">$</span>JWDP)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>JWAP_fixed <span class="ot">&lt;-</span> fixed_JWAP<span class="sc">$</span>value_list</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>JWDP_fixed <span class="ot">&lt;-</span> fixed_JWDP<span class="sc">$</span>value_list</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>JWAP_midpoints <span class="ot">&lt;-</span> fixed_JWAP<span class="sc">$</span>midpoints</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>JWDP_midpoints <span class="ot">&lt;-</span> fixed_JWDP<span class="sc">$</span>midpoints</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># order the var_filtered items columns for better viewing purposes</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  var_filtered<span class="sc">$</span>JWAP <span class="ot">&lt;-</span> var_filtered<span class="sc">$</span>JWAP<span class="sc">$</span>values<span class="sc">$</span>item[<span class="fu">order</span>(<span class="fu">names</span>(var_filtered<span class="sc">$</span>JWAP<span class="sc">$</span>values<span class="sc">$</span>item))]</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  var_filtered<span class="sc">$</span>JWDP <span class="ot">&lt;-</span> var_filtered<span class="sc">$</span>JWDP<span class="sc">$</span>values<span class="sc">$</span>item[<span class="fu">order</span>(<span class="fu">names</span>(var_filtered<span class="sc">$</span>JWDP<span class="sc">$</span>values<span class="sc">$</span>item))]</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span>(<span class="at">data=</span>data, <span class="at">var_info=</span>var_filtered))</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>test_2_pp <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test converting columns to numeric, given a list of numeric columns and a list of columns to exclude</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># str of data will have int where a character was</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">census_tibble</span>(<span class="fu">census_url</span>(<span class="at">year=</span><span class="st">"2022"</span>, <span class="at">get_vals=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"SEX"</span>, <span class="st">"JWAP"</span>), <span class="at">for_val=</span><span class="st">"state:10"</span>))</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">convert_columns_to_numeric</span>(data, <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"JWAP"</span>))</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (data)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>test_3_pp <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test the removal of categorical items in numeric columns (removes the 0)</span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">census_tibble</span>(<span class="fu">census_url</span>(<span class="at">year=</span><span class="st">"2022"</span>, <span class="at">get_vals=</span><span class="st">"AGEP"</span>, <span class="at">for_val=</span><span class="st">"state:10"</span>))</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>  var_filtered <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="st">"2022"</span>, <span class="st">"AGEP"</span>)</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(<span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convert_columns_to_numeric</span>(<span class="st">"AGEP"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_categorical_row_items_in_numeric</span>(var_filtered)</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span>(<span class="at">data=</span>data, <span class="at">var_info=</span>var_filtered))</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>test_4_pp <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test the replacement of the categorical items with the factor labels</span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">census_tibble</span>(<span class="fu">census_url</span>(<span class="at">year=</span><span class="st">"2022"</span>, <span class="at">get_vals=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"SEX"</span>, <span class="st">"HISPEED"</span>), <span class="at">for_val=</span><span class="st">"state:10"</span>))</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>  var_filtered <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="st">"2022"</span>, <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"SEX"</span>, <span class="st">"HISPEED"</span>, <span class="st">"ST"</span>))</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>SEX_saved <span class="ot">&lt;-</span> data<span class="sc">$</span>SEX</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>HISPEED_saved <span class="ot">&lt;-</span> data<span class="sc">$</span>HISPEED</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>ST_saved <span class="ot">&lt;-</span> data<span class="sc">$</span>state</span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(<span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convert_columns_to_numeric</span>(<span class="st">"AGEP"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_categorical_row_items_in_numeric</span>(var_filtered) <span class="sc">|&gt;</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convert_categorical_to_factor</span>(var_filtered)</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>  var_filtered<span class="sc">$</span>AGEP <span class="ot">&lt;-</span> var_filtered<span class="sc">$</span>AGEP<span class="sc">$</span>values</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>  var_filtered<span class="sc">$</span>SEX <span class="ot">&lt;-</span> var_filtered<span class="sc">$</span>SEX<span class="sc">$</span>values<span class="sc">$</span>item[<span class="fu">order</span>(<span class="fu">names</span>(var_filtered<span class="sc">$</span>SEX<span class="sc">$</span>values<span class="sc">$</span>item))]</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>  var_filtered<span class="sc">$</span>HISPEED <span class="ot">&lt;-</span> var_filtered<span class="sc">$</span>HISPEED<span class="sc">$</span>values<span class="sc">$</span>item[<span class="fu">order</span>(<span class="fu">names</span>(var_filtered<span class="sc">$</span>HISPEED<span class="sc">$</span>values<span class="sc">$</span>item))]</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>  var_filtered<span class="sc">$</span>ST <span class="ot">&lt;-</span> var_filtered<span class="sc">$</span>ST<span class="sc">$</span>values<span class="sc">$</span>item[<span class="fu">order</span>(<span class="fu">names</span>(var_filtered<span class="sc">$</span>ST<span class="sc">$</span>values<span class="sc">$</span>item))]</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">data=</span>data, <span class="at">var_info=</span>var_filtered))</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the time conversion in action.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>data_1_pp <span class="ot">&lt;-</span> <span class="fu">test_1_pp</span>()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_1_pp<span class="sc">$</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [771 × 7] (S3: tbl_df/tbl/data.frame)
 $ JWAP          : chr [1:771] "0" "74" "76" "109" ...
 $ JWDP          : chr [1:771] "0" "31" "31" "67" ...
 $ state         : chr [1:771] "10" "10" "10" "10" ...
 $ JWAP_fixed    : chr [1:771] "NA" "6.36666666666667" "6.53333333333333" "9.28333333333333" ...
 $ JWDP_fixed    : chr [1:771] "NA" "6.03333333333333" "6.03333333333333" "9.03333333333333" ...
 $ JWAP_midpoints: chr [1:771] "NA" "06:22:00" "06:32:00" "09:17:00" ...
 $ JWDP_midpoints: chr [1:771] "NA" "06:02:00" "06:02:00" "09:02:00" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the sorted time list to compare.</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_1_pp<span class="sc">$</span>var_info, <span class="at">max.level=</span><span class="dv">2</span>, <span class="at">list.len=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ JWAP:List of 286
  ..$ 0  : chr "N/A (not a worker; worker who worked from home)"
  ..$ 001: chr "12:00 a.m. to 12:04 a.m."
  ..$ 002: chr "12:05 a.m. to 12:09 a.m."
  ..$ 003: chr "12:10 a.m. to 12:14 a.m."
  ..$ 004: chr "12:15 a.m. to 12:19 a.m."
  .. [list output truncated]
 $ JWDP:List of 151
  ..$ 0  : chr "N/A (not a worker; worker who worked from home)"
  ..$ 001: chr "12:00 a.m. to 12:29 a.m."
  ..$ 002: chr "12:30 a.m. to 12:59 a.m."
  ..$ 003: chr "1:00 a.m. to 1:29 a.m."
  ..$ 004: chr "1:30 a.m. to 1:59 a.m."
  .. [list output truncated]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the expected column for numeric is converted to int column from character.</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>data_2_pp <span class="ot">&lt;-</span> <span class="fu">test_2_pp</span>()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_2_pp, <span class="at">max.level=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [9,641 × 4] (S3: tbl_df/tbl/data.frame)
 $ AGEP : num [1:9641] 84 39 19 77 18 32 50 23 20 18 ...
 $ SEX  : chr [1:9641] "2" "2" "2" "2" ...
 $ JWAP : num [1:9641] 0 0 0 0 0 0 0 74 0 0 ...
 $ state: chr [1:9641] "10" "10" "10" "10" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show that 0 is not in the table, because it fell out of the min-max range and was in the item section as</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># a categorical type value for the numeric column.</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>data_3_pp <span class="ot">&lt;-</span> <span class="fu">test_3_pp</span>()</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># doesnt have 0 in the int list anymore</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">table</span>(data_3_pp<span class="sc">$</span>data<span class="sc">$</span>AGEP), <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1 2 3 4 5 
1 1 1 1 1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the factor change with preserved comparison columns of what changed.</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>data_4_pp <span class="ot">&lt;-</span> <span class="fu">test_4_pp</span>()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_4_pp<span class="sc">$</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [513 × 7] (S3: tbl_df/tbl/data.frame)
 $ AGEP         : num [1:513] 84 39 19 77 18 32 50 23 20 93 ...
 $ SEX          : Factor w/ 2 levels "Male","Female": 2 2 2 2 2 1 1 1 2 2 ...
 $ HISPEED      : Factor w/ 3 levels "N/A (GQ/vacant/no paid access to the internet)",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ state        : Factor w/ 52 levels "Alabama/AL","Alaska/AK",..: 8 8 8 8 8 8 8 8 8 8 ...
 $ SEX_saved    : chr [1:513] "2" "2" "2" "2" ...
 $ HISPEED_saved: chr [1:513] "0" "0" "0" "0" ...
 $ ST_saved     : chr [1:513] "10" "10" "10" "10" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show a sorted list to easily compare the factor conversion.</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_4_pp<span class="sc">$</span>var_info, <span class="at">max.level=</span><span class="dv">3</span>, <span class="at">list.len=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ AGEP   :List of 2
  ..$ item :List of 1
  .. ..$ 00: chr "Under 1 year"
  ..$ range:'data.frame':   1 obs. of  3 variables:
  .. ..$ min        : chr "1"
  .. ..$ max        : chr "99"
  .. ..$ description: chr "1 to 99 years (Top-coded***)"
 $ SEX    :List of 2
  ..$ 1: chr "Male"
  ..$ 2: chr "Female"
 $ HISPEED:List of 3
  ..$ 0: chr "N/A (GQ/vacant/no paid access to the internet)"
  ..$ 1: chr "Yes"
  ..$ 2: chr "No"
 $ ST     :List of 52
  ..$ 01: chr "Alabama/AL"
  ..$ 02: chr "Alaska/AK"
  ..$ 04: chr "Arizona/AZ"
  ..$ 05: chr "Arkansas/AR"
  ..$ 06: chr "California/CA"
  .. [list output truncated]</code></pre>
</div>
</div>
</section>
</section>
<section id="were-putting-all-the-prior-functions-and-data-processing-into-one-function-with-extra-input-validation-to-match-with-the-requirements.the-final-tibble-url-and-variable-list-is-returned-for-use." class="level3">
<h3 class="anchored" data-anchor-id="were-putting-all-the-prior-functions-and-data-processing-into-one-function-with-extra-input-validation-to-match-with-the-requirements.the-final-tibble-url-and-variable-list-is-returned-for-use.">We’re putting all the prior functions and data processing into one function with extra input validation to match with the requirements.The final tibble, URL, and variable list is returned for use.</h3>
<section id="load-the-main-function-where-it-gets-the-tibble-and-applies-all-the-input-constraints-and-data-processing." class="level4">
<h4 class="anchored" data-anchor-id="load-the-main-function-where-it-gets-the-tibble-and-applies-all-the-input-constraints-and-data-processing.">Load the main function where it gets the tibble and applies all the input constraints and data processing.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/census_query.R"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/census_variables.R"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/input_validation.R"</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/post_processing.R"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>get_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">year=</span><span class="st">"2022"</span>, <span class="at">variables=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>), <span class="at">geography_level=</span><span class="st">"state:10"</span>) {</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check if PWGTP is provided in the variable list. May be PWGTP=30 or PWGTP=30,50</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">"^PWGTP$"</span>, variables))) {</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    variables <span class="ot">&lt;-</span> <span class="fu">c</span>(variables, <span class="st">"PWGTP"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ensure year is between 2010 and 2022 (inclusive)</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  year_options <span class="ot">&lt;-</span> <span class="dv">2010</span><span class="sc">:</span><span class="dv">2022</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>year <span class="sc">%in%</span> year_options) {</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">glue</span>(<span class="st">"Invalid year {year}, should be one of [{glue_collapse(year_options, sep=', ')}]"</span>))</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ensure variables is in the desired set given</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  variable_options <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"GASP"</span>, <span class="st">"GRPIP"</span>, <span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>, <span class="st">"JWMNP"</span>, <span class="st">"SEX"</span>, <span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"HISPEED"</span>, <span class="st">"JWTRNS"</span>, <span class="st">"SCH"</span>, <span class="st">"SCHL"</span>)</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is_valid_variable_input</span>(variables, variable_options)) {</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">glue</span>(<span class="st">"Invalid variable in [{glue_collapse(variables, sep=', ')}], valid options [{glue_collapse(variable_options, sep=', ')}]"</span>))</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  geography_options <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state:"</span>, <span class="st">"region:"</span>, <span class="st">"division:"</span>)</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (geography_level <span class="sc">!=</span> <span class="st">""</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is_valid_variable_input</span>(geography_level, geography_options, <span class="at">sep=</span><span class="st">":"</span>, <span class="at">with_delim=</span><span class="cn">TRUE</span>)) {</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">glue</span>(<span class="st">"Invalid geography level {geography_level}, should be 'all' or one of [{glue_collapse(geography_options, sep=', ')}]"</span>))</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>  filtered_var_info <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(year, <span class="fu">c</span>(variable_options, <span class="st">"ST"</span>, <span class="st">"REGION"</span>, <span class="st">"DIVISION"</span>))</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># some years dont have data</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove variables where they don't exist</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">names</span>(filtered_var_info)) {</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(filtered_var_info[[var]]) <span class="sc">|</span> <span class="fu">is.null</span>(filtered_var_info[[var]]<span class="sc">$</span>values)) {</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"removing "</span>, var, <span class="st">" from year "</span>, year))</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>      filtered_var_info <span class="ot">&lt;-</span> filtered_var_info[<span class="sc">!</span><span class="fu">names</span>(filtered_var_info) <span class="sc">%in%</span> var]</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (var2 <span class="cf">in</span> variables) {</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">grepl</span>(var, var2))) {</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"removing variable "</span>, var2, <span class="st">" from year "</span>, year))</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>          variables <span class="ot">&lt;-</span> variables[variables <span class="sc">!=</span> var2]</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use the most updated variable list for geography level - not in prior years but still can filter</span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for those years, use prior variables for rest though, in case mapping changed for some reason</span></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>  needed_items <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>  needed_items <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(filtered_var_info<span class="sc">$</span>ST), <span class="fu">c</span>(needed_items, <span class="st">"ST"</span>), needed_items)</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>  needed_items <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(filtered_var_info<span class="sc">$</span>REGION), <span class="fu">c</span>(needed_items, <span class="st">"REGION"</span>), needed_items)</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>  needed_items <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.null</span>(filtered_var_info<span class="sc">$</span>DIVISION), <span class="fu">c</span>(needed_items, <span class="st">"DIVISION"</span>), needed_items)</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(needed_items)) {</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>    newest_geography_variables <span class="ot">&lt;-</span> <span class="fu">get_variable_list</span>(<span class="dv">2022</span>, needed_items)</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>    filtered_var_info <span class="ot">&lt;-</span> <span class="fu">c</span>(filtered_var_info, newest_geography_variables)</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># PWGTP always included</span></span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># AGEP as default, at least 1 numeric variable needs to be returned aside from PWGTP</span></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># do for loop that checks if range is in the var_data values (AGEP,PWGTP,etc.) ex) var_data$AGEP$values$range</span></span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># SEX is default categorical variable</span></span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># at least one categorical variable needs to be returned</span></span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>  numeric_items_count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>  categorical_items_count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>  numeric_item_list <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check and filter the passed in variables</span></span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (var <span class="cf">in</span> variables) {</span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a>    var_split <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(var, <span class="st">"="</span>)[[<span class="dv">1</span>]]</span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> var_split[<span class="dv">1</span>]</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>    values <span class="ot">&lt;-</span> var_split[<span class="dv">2</span>]</span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(paste(var, values, sep=" "))</span></span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is_numeric_variable</span>(var, filtered_var_info)) {</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>      numeric_item_list <span class="ot">&lt;-</span> <span class="fu">c</span>(numeric_item_list, var)</span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>      numeric_items_count <span class="ot">&lt;-</span> numeric_items_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>      categorical_items_count <span class="ot">&lt;-</span> categorical_items_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(get_valid_variable_values(var, filtered_var_info))</span></span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (numeric_items_count <span class="sc">&lt;=</span> <span class="dv">1</span>) {</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>    variables <span class="ot">&lt;-</span> <span class="fu">c</span>(variables, <span class="st">"AGEP"</span>)</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a>    numeric_item_list <span class="ot">&lt;-</span> <span class="fu">c</span>(numeric_item_list, <span class="st">"AGEP"</span>)</span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print("AGEP NA")</span></span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(get_valid_variable_values("AGEP", filtered_var_info))</span></span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (categorical_items_count <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a>    variables <span class="ot">&lt;-</span> <span class="fu">c</span>(variables, <span class="st">"SEX"</span>)</span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print("SEX NA")</span></span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(get_valid_variable_values("SEX", filtered_var_info))</span></span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a>  var_with_filter <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (var <span class="cf">in</span> variables) {</span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">regexpr</span>(<span class="st">"="</span>, var) <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span>) {</span>
<span id="cb55-100"><a href="#cb55-100" aria-hidden="true" tabindex="-1"></a>      var_with_filter <span class="ot">&lt;-</span> <span class="fu">c</span>(var_with_filter, var)</span>
<span id="cb55-101"><a href="#cb55-101" aria-hidden="true" tabindex="-1"></a>      variables <span class="ot">&lt;-</span> variables[variables <span class="sc">!=</span> var]</span>
<span id="cb55-102"><a href="#cb55-102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-103"><a href="#cb55-103" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-104"><a href="#cb55-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-105"><a href="#cb55-105" aria-hidden="true" tabindex="-1"></a>  URL <span class="ot">&lt;-</span> <span class="fu">census_url</span>(<span class="at">year=</span>year, <span class="at">get_vals=</span>variables, <span class="at">get_vals_subset=</span>var_with_filter, <span class="at">for_val=</span>geography_level)</span>
<span id="cb55-106"><a href="#cb55-106" aria-hidden="true" tabindex="-1"></a>  parsed_tibble <span class="ot">&lt;-</span> <span class="fu">census_tibble</span>(URL)</span>
<span id="cb55-107"><a href="#cb55-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-108"><a href="#cb55-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"JWAP"</span> <span class="sc">%in%</span> <span class="fu">names</span>(parsed_tibble)) {</span>
<span id="cb55-109"><a href="#cb55-109" aria-hidden="true" tabindex="-1"></a>    parsed_tibble<span class="sc">$</span>JWAP <span class="ot">&lt;-</span> <span class="fu">fix_time_interval_categories</span>(filtered_var_info<span class="sc">$</span>JWAP<span class="sc">$</span>values<span class="sc">$</span>item, parsed_tibble<span class="sc">$</span>JWAP)<span class="sc">$</span>value_list</span>
<span id="cb55-110"><a href="#cb55-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-111"><a href="#cb55-111" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"JWDP"</span> <span class="sc">%in%</span> <span class="fu">names</span>(parsed_tibble)) {</span>
<span id="cb55-112"><a href="#cb55-112" aria-hidden="true" tabindex="-1"></a>    parsed_tibble<span class="sc">$</span>JWDP <span class="ot">&lt;-</span> <span class="fu">fix_time_interval_categories</span>(filtered_var_info<span class="sc">$</span>JWDP<span class="sc">$</span>values<span class="sc">$</span>item, parsed_tibble<span class="sc">$</span>JWDP)<span class="sc">$</span>value_list</span>
<span id="cb55-113"><a href="#cb55-113" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-114"><a href="#cb55-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(glue("Numeric item list, gets converted to int - [{glue_collapse(numeric_item_list, sep=', ')}]"))</span></span>
<span id="cb55-115"><a href="#cb55-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(glue("List without JWAP and JWDP - [{glue_collapse(numeric_item_list[!numeric_item_list %in% c('JWDP', 'JWAP')], sep=', ')}]"))</span></span>
<span id="cb55-116"><a href="#cb55-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-117"><a href="#cb55-117" aria-hidden="true" tabindex="-1"></a>  parsed_tibble <span class="ot">&lt;-</span> parsed_tibble <span class="sc">|&gt;</span></span>
<span id="cb55-118"><a href="#cb55-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convert_columns_to_numeric</span>(numeric_item_list) <span class="sc">|&gt;</span></span>
<span id="cb55-119"><a href="#cb55-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">remove_categorical_row_items_in_numeric</span>(filtered_var_info) <span class="sc">|&gt;</span></span>
<span id="cb55-120"><a href="#cb55-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">convert_categorical_to_factor</span>(filtered_var_info)</span>
<span id="cb55-121"><a href="#cb55-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-122"><a href="#cb55-122" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add census class to the parsed tibble</span></span>
<span id="cb55-123"><a href="#cb55-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(parsed_tibble) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"census"</span>, <span class="fu">class</span>(parsed_tibble))</span>
<span id="cb55-124"><a href="#cb55-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">parsed=</span>parsed_tibble, <span class="at">var_info=</span>filtered_var_info, <span class="at">URL=</span>URL))</span>
<span id="cb55-125"><a href="#cb55-125" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-126"><a href="#cb55-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-127"><a href="#cb55-127" aria-hidden="true" tabindex="-1"></a>get_data_years <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">years=</span><span class="st">"2022"</span>, <span class="at">variables=</span><span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"SEX"</span>), <span class="at">geography_level=</span><span class="st">"state:10"</span>) {</span>
<span id="cb55-128"><a href="#cb55-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get multiple years of data, removing 2020 if given - year is not valid for some reason</span></span>
<span id="cb55-129"><a href="#cb55-129" aria-hidden="true" tabindex="-1"></a>  years <span class="ot">&lt;-</span> years[years <span class="sc">!=</span> <span class="dv">2020</span>]</span>
<span id="cb55-130"><a href="#cb55-130" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(years, <span class="cf">function</span>(year) <span class="fu">get_data</span>(<span class="at">year=</span>year, <span class="at">variables=</span>variables, <span class="at">geography_level=</span>geography_level))</span>
<span id="cb55-131"><a href="#cb55-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(results) <span class="ot">&lt;-</span> years</span>
<span id="cb55-132"><a href="#cb55-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(results)</span>
<span id="cb55-133"><a href="#cb55-133" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-the-tests-that-display-the-usage-of-the-main-get_data-function-and-the-list-version-multiple-years." class="level4">
<h4 class="anchored" data-anchor-id="load-the-tests-that-display-the-usage-of-the-main-get_data-function-and-the-list-version-multiple-years.">Load the tests that display the usage of the main get_data function and the list version (multiple years).</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/main.R"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>test_1_m <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test get a year</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="st">"2022"</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  variable_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"GASP"</span>, <span class="st">"GRPIP"</span>, <span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>, <span class="st">"JWMNP"</span>, <span class="st">"SEX"</span>, <span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"HISPEED"</span>, <span class="st">"JWTRNS"</span>, <span class="st">"SCH"</span>, <span class="st">"SCHL"</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  geography_level <span class="ot">&lt;-</span> <span class="st">"state:10"</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  return_data <span class="ot">&lt;-</span> <span class="fu">get_data</span>(</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">year=</span>year,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables=</span>variable_list,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">geography_level =</span> geography_level</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (return_data)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>test_2_m <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># test get all years in range</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  years <span class="ot">&lt;-</span> <span class="dv">2010</span><span class="sc">:</span><span class="dv">2022</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  variable_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"GASP"</span>, <span class="st">"GRPIP"</span>, <span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>, <span class="st">"JWMNP"</span>, <span class="st">"SEX"</span>, <span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"HISPEED"</span>, <span class="st">"JWTRNS"</span>, <span class="st">"SCH"</span>, <span class="st">"SCHL"</span>)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  geography_level <span class="ot">&lt;-</span> <span class="st">"state:10"</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  return_data <span class="ot">&lt;-</span> <span class="fu">get_data_years</span>(</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">years=</span>years,</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables=</span>variable_list,</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">geography_level =</span> geography_level</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (return_data)</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the main get_data function with all the valid values and the default state:10.</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>data_1_m <span class="ot">&lt;-</span> <span class="fu">test_1_m</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Returned function gives the URL, the filtered variable list with everything provided, and the tibble.</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>data_1_m<span class="sc">$</span>URL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>https://api.census.gov/data/2022/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,HISPEED,JWTRNS,SCH,SCHL&amp;for=state:10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_1_m<span class="sc">$</span>parsed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>census [9,569 × 15] (S3: census/tbl_df/tbl/data.frame)
 $ AGEP   : num [1:9569] 84 39 19 77 18 32 50 23 20 18 ...
 $ PWGTP  : num [1:9569] 76 20 92 19 32 80 132 19 47 201 ...
 $ GASP   : num [1:9569] 3 3 3 3 3 3 3 3 3 3 ...
 $ GRPIP  : num [1:9569] 0 0 0 0 0 0 0 0 0 0 ...
 $ JWAP   : num [1:9569] NA NA NA NA NA ...
 $ JWDP   : num [1:9569] NA NA NA NA NA ...
 $ JWMNP  : num [1:9569] 0 0 0 0 0 0 0 20 0 0 ...
 $ SEX    : Factor w/ 2 levels "Male","Female": 2 2 2 2 2 1 1 1 2 2 ...
 $ FER    : Factor w/ 3 levels "N/A (less than 15 years/greater than 50 years/ male)",..: 1 3 3 1 3 1 1 1 3 3 ...
 $ HHL    : Factor w/ 6 levels "N/A (GQ/vacant)",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ HISPEED: Factor w/ 3 levels "N/A (GQ/vacant/no paid access to the internet)",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ JWTRNS : Factor w/ 13 levels "N/A (not a worker-not in the labor force, including persons under 16 years; unemployed; employed, with a job bu"| __truncated__,..: 1 1 1 1 1 1 1 2 1 1 ...
 $ SCH    : Factor w/ 4 levels "N/A (less than 3 years old)",..: 2 2 3 2 3 2 2 4 3 3 ...
 $ SCHL   : Factor w/ 25 levels "N/A (less than 3 years old)",..: 22 17 20 22 17 17 22 22 20 17 ...
 $ state  : Factor w/ 52 levels "Alabama/AL","Alaska/AK",..: 8 8 8 8 8 8 8 8 8 8 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calls for every year - some missing variables, which is handled.</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>data_2_m <span class="ot">&lt;-</span> <span class="fu">test_2_m</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing HISPEED from year 2010"
[1] "removing variable HISPEED from year 2010"
[1] "removing JWTRNS from year 2010"
[1] "removing variable JWTRNS from year 2010"
[1] "removing ST from year 2010"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing HISPEED from year 2011"
[1] "removing variable HISPEED from year 2011"
[1] "removing JWTRNS from year 2011"
[1] "removing variable JWTRNS from year 2011"
[1] "removing ST from year 2011"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing HISPEED from year 2012"
[1] "removing variable HISPEED from year 2012"
[1] "removing JWTRNS from year 2012"
[1] "removing variable JWTRNS from year 2012"
[1] "removing ST from year 2012"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing HISPEED from year 2013"
[1] "removing variable HISPEED from year 2013"
[1] "removing JWTRNS from year 2013"
[1] "removing variable JWTRNS from year 2013"
[1] "removing ST from year 2013"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing HISPEED from year 2014"
[1] "removing variable HISPEED from year 2014"
[1] "removing JWTRNS from year 2014"
[1] "removing variable JWTRNS from year 2014"
[1] "removing ST from year 2014"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing HISPEED from year 2015"
[1] "removing variable HISPEED from year 2015"
[1] "removing JWTRNS from year 2015"
[1] "removing variable JWTRNS from year 2015"
[1] "removing ST from year 2015"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing JWTRNS from year 2016"
[1] "removing variable JWTRNS from year 2016"
[1] "removing ST from year 2016"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing JWTRNS from year 2017"
[1] "removing variable JWTRNS from year 2017"
[1] "removing ST from year 2017"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing JWTRNS from year 2018"
[1] "removing variable JWTRNS from year 2018"
[1] "removing ST from year 2018"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "removing ST from year 2019"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.
There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.
There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_2_m, <span class="at">max.level =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 12
 $ 2010:List of 3
  ..$ parsed  : census [8,494 × 13] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 15
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2010/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,SCH,SCHL&amp;for=state:10"
 $ 2011:List of 3
  ..$ parsed  : census [8,906 × 13] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 15
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2011/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,SCH,SCHL&amp;for=state:10"
 $ 2012:List of 3
  ..$ parsed  : census [8,733 × 13] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 15
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2012/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,SCH,SCHL&amp;for=state:10"
 $ 2013:List of 3
  ..$ parsed  : census [8,682 × 13] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 15
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2013/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,SCH,SCHL&amp;for=state:10"
 $ 2014:List of 3
  ..$ parsed  : census [8,923 × 13] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 15
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2014/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,SCH,SCHL&amp;for=state:10"
 $ 2015:List of 3
  ..$ parsed  : census [8,926 × 13] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 15
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2015/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,SCH,SCHL&amp;for=state:10"
 $ 2016:List of 3
  ..$ parsed  : census [8,801 × 14] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 16
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2016/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,HISPEED,SC"| __truncated__
 $ 2017:List of 3
  ..$ parsed  : census [8,868 × 14] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 16
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2017/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,HISPEED,SC"| __truncated__
 $ 2018:List of 3
  ..$ parsed  : census [9,043 × 14] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 16
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2018/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,HISPEED,SC"| __truncated__
 $ 2019:List of 3
  ..$ parsed  : census [9,197 × 15] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 17
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2019/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,HISPEED,JW"| __truncated__
 $ 2021:List of 3
  ..$ parsed  : census [9,361 × 15] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 17
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2021/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,HISPEED,JW"| __truncated__
 $ 2022:List of 3
  ..$ parsed  : census [9,569 × 15] (S3: census/tbl_df/tbl/data.frame)
  ..$ var_info:List of 17
  ..$ URL     : 'glue' chr "https://api.census.gov/data/2022/acs/acs1/pums?get=AGEP,PWGTP,GASP,GRPIP,JWAP,JWDP,JWMNP,SEX,FER,HHL,HISPEED,JW"| __truncated__</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="summarizing-and-plotting" class="level2">
<h2 class="anchored" data-anchor-id="summarizing-and-plotting">Summarizing and Plotting</h2>
<section id="we-create-the-functions-for-both-summarizing-and-plotting-a-census-tibble-which-is-what-is-returned-as-the-tibble-from-the-get_data." class="level3">
<h3 class="anchored" data-anchor-id="we-create-the-functions-for-both-summarizing-and-plotting-a-census-tibble-which-is-what-is-returned-as-the-tibble-from-the-get_data.">We create the functions for both summarizing and plotting a census tibble (which is what is returned as the tibble from the get_data).</h3>
<section id="load-the-summarizing-functions.-one-is-for-countsmeansd-another-is-for-plotting." class="level4">
<h4 class="anchored" data-anchor-id="load-the-summarizing-functions.-one-is-for-countsmeansd-another-is-for-plotting.">Load the summarizing functions. One is for counts/mean/sd, another is for plotting.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SparseM</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>summary_census <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  x,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">categorical=</span><span class="fu">c</span>(<span class="st">"SEX"</span>,<span class="st">"FER"</span>,<span class="st">"HHL"</span>,<span class="st">"SCH"</span>,<span class="st">"SCHL"</span>, <span class="st">"HISPEED"</span>, <span class="st">"PWGTP"</span>,<span class="st">"REGION"</span>,<span class="st">"DIVISION"</span>,<span class="st">"STATE"</span>),</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">numerical=</span><span class="fu">c</span>(<span class="st">"GASP"</span>, <span class="st">"GRPIP"</span>,<span class="st">"AGEP"</span>, <span class="st">"JWMNP"</span>, <span class="st">"PWGTP"</span>, <span class="st">"JWAP"</span>, <span class="st">"JWDP"</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>) {</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Finding mean/sd/counts for numerical and categorical data</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"census"</span> <span class="sc">%in%</span> <span class="fu">class</span>(x))) {</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Input must be a census object"</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># from the inputs, split into categorical and numerical data</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  new_data_cat <span class="ot">&lt;-</span> x[<span class="fu">names</span>(x) <span class="sc">%in%</span> categorical]</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  new_data_num <span class="ot">&lt;-</span> x[<span class="fu">names</span>(x) <span class="sc">%in%</span> numerical]</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>  cat_counts_result <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  num_mean_sd_result <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(new_data_cat)) {</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (col <span class="sc">==</span> <span class="st">"PWGTP"</span>) {</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    cat_counts_result[[col]] <span class="ot">&lt;-</span> new_data_cat <span class="sc">|&gt;</span></span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="sc">!!</span><span class="fu">sym</span>(col)) <span class="sc">|&gt;</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">count=</span><span class="fu">sum</span>(PWGTP))</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(new_data_num)) {</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (col <span class="sc">==</span> <span class="st">"PWGTP"</span>) {</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>    num_mean_sd_result[[col]] <span class="ot">&lt;-</span> new_data_num <span class="sc">|&gt;</span></span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">new_mult =</span> <span class="sc">!!</span><span class="fu">sym</span>(col) <span class="sc">*</span> PWGTP) <span class="sc">|&gt;</span></span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">sum</span>(new_mult) <span class="sc">/</span> <span class="fu">sum</span>(PWGTP),</span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">sd=</span><span class="fu">sqrt</span>(<span class="fu">sum</span>(PWGTP <span class="sc">*</span> (<span class="sc">!!</span><span class="fu">sym</span>(col) <span class="sc">-</span> mean)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>(PWGTP)))</span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">list</span>(<span class="at">cat_results=</span>cat_counts_result, <span class="at">num_results=</span>num_mean_sd_result))</span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a><span class="co"># # We chose to investigate the populations educational level base on age. We were interested in showing people who are typical school age range.</span></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a><span class="co"># parsed2&lt;- parsed %&gt;%</span></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(AGEP&lt;=40 &amp; AGEP &gt;=5)%&gt;%</span></span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x =SCH, y =AGEP, weight= PWGTP,fill = SCH, color = SCH))+</span></span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_boxplot()</span></span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a><span class="co"># print(parsed2)</span></span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a>plot_census <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">categorical=</span><span class="st">"SCH"</span>, <span class="at">numerical=</span><span class="st">"AGEP"</span>) {</span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"census"</span> <span class="sc">%in%</span> <span class="fu">class</span>(x))) {</span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Input must be a census object"</span>)</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(categorical) <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">length</span>(numerical) <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Only one categorical and one numerical variable can be plotted"</span>)</span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span></span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="sc">!!</span><span class="fu">sym</span>(categorical), <span class="at">y=</span><span class="sc">!!</span><span class="fu">sym</span>(numerical), <span class="at">weight=</span>PWGTP, <span class="at">fill=</span><span class="sc">!!</span><span class="fu">sym</span>(categorical), <span class="at">color=</span><span class="sc">!!</span><span class="fu">sym</span>(categorical))) <span class="sc">+</span></span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_boxplot</span>()</span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-the-example-usages." class="level4">
<h4 class="anchored" data-anchor-id="load-the-example-usages.">Load the example usages.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/summarizing.R"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"src/main.R"</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"test/test_main.R"</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>test_1_s <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  parsed <span class="ot">&lt;-</span> <span class="fu">test_1_m</span>()<span class="sc">$</span>parsed</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fu">summary_census</span>(parsed))</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>test_2_s <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  parsed <span class="ot">&lt;-</span> <span class="fu">test_1_m</span>()<span class="sc">$</span>parsed</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_census</span>(parsed)</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gives a view of the summary values.</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_1_s</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$cat_results
$cat_results$SEX
# A tibble: 2 × 2
  SEX     count
  &lt;fct&gt;   &lt;dbl&gt;
1 Male   488442
2 Female 520323

$cat_results$FER
# A tibble: 3 × 2
  FER                                                   count
  &lt;fct&gt;                                                 &lt;dbl&gt;
1 N/A (less than 15 years/greater than 50 years/ male) 785329
2 Yes                                                   10669
3 No                                                   212767

$cat_results$HHL
# A tibble: 6 × 2
  HHL                                 count
  &lt;fct&gt;                               &lt;dbl&gt;
1 N/A (GQ/vacant)                     22688
2 English Only                       796054
3 Spanish                             95801
4 Other Indo-European languages       41022
5 Asian and Pacific Island languages  29736
6 Other Language                      23464

$cat_results$HISPEED
# A tibble: 3 × 2
  HISPEED                                         count
  &lt;fct&gt;                                           &lt;dbl&gt;
1 N/A (GQ/vacant/no paid access to the internet)  74950
2 Yes                                            830510
3 No                                             103305

$cat_results$SCH
# A tibble: 4 × 2
  SCH                                            count
  &lt;fct&gt;                                          &lt;dbl&gt;
1 N/A (less than 3 years old)                    20751
2 No, has not attended in the last 3 months     755797
3 Yes, public school or public college          195091
4 Yes, private school or college or home school  37126

$cat_results$SCHL
# A tibble: 25 × 2
   SCHL                        count
   &lt;fct&gt;                       &lt;dbl&gt;
 1 N/A (less than 3 years old) 20751
 2 No schooling completed      29639
 3 Nursery school, preschool   16425
 4 Kindergarten                13248
 5 Grade 1                     10178
 6 Grade 2                     10938
 7 Grade 3                     12126
 8 Grade 4                     12208
 9 Grade 5                     11754
10 Grade 6                     14467
# ℹ 15 more rows


$num_results
$num_results$AGEP
# A tibble: 1 × 2
   mean    sd
  &lt;dbl&gt; &lt;dbl&gt;
1  42.0  23.6

$num_results$GASP
# A tibble: 1 × 2
   mean    sd
  &lt;dbl&gt; &lt;dbl&gt;
1  64.1  135.

$num_results$GRPIP
# A tibble: 1 × 2
   mean    sd
  &lt;dbl&gt; &lt;dbl&gt;
1  7.84  19.1

$num_results$JWAP
# A tibble: 1 × 2
   mean    sd
  &lt;dbl&gt; &lt;dbl&gt;
1    NA    NA

$num_results$JWDP
# A tibble: 1 × 2
   mean    sd
  &lt;dbl&gt; &lt;dbl&gt;
1    NA    NA

$num_results$JWMNP
# A tibble: 1 × 2
   mean    sd
  &lt;dbl&gt; &lt;dbl&gt;
1  10.8  19.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots the default AGEP and SCH</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">test_2_s</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project1_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="investigating" class="level2">
<h2 class="anchored" data-anchor-id="investigating">Investigating</h2>
<section id="the-default-plot-above-is-the-result-of-investigating-something-interesting.-when-looking-at-agep-against-sch-we-get-to-see-the-different-types-of-attendance-separated-out-by-age." class="level3">
<h3 class="anchored" data-anchor-id="the-default-plot-above-is-the-result-of-investigating-something-interesting.-when-looking-at-agep-against-sch-we-get-to-see-the-different-types-of-attendance-separated-out-by-age.">The default plot above is the result of investigating something interesting. When looking at AGEP against SCH, we get to see the different types of attendance separated out by age.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_2_s</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `across(...)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Project1_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="less-than-3-years-old-was-filtered-out-as-it-is-quite-uninteresting-but-the-default-plot-has-not-had-that-capability-put-in.-all-the-count-for-less-than-3-years-old-falls-into-the-ages-0-3." class="level4">
<h4 class="anchored" data-anchor-id="less-than-3-years-old-was-filtered-out-as-it-is-quite-uninteresting-but-the-default-plot-has-not-had-that-capability-put-in.-all-the-count-for-less-than-3-years-old-falls-into-the-ages-0-3.">Less than 3 years old was filtered out as it is quite uninteresting, but the default plot has not had that capability put in. All the count for less than 3 years old falls into the ages 0-3.</h4>
</section>
<section id="more-interesting-is-the-comparison-of-the-other-3.-those-that-have-not-attended-school-recently-are-as-expected-the-older-population-generally.-the-thought-was-that-the-older-population-tended-to-go-to-private-schools-more-with-the-primary-driver-being-online-course-offerings-and-part-time-attendance.-this-is-consistent-with-the-data-plot." class="level4">
<h4 class="anchored" data-anchor-id="more-interesting-is-the-comparison-of-the-other-3.-those-that-have-not-attended-school-recently-are-as-expected-the-older-population-generally.-the-thought-was-that-the-older-population-tended-to-go-to-private-schools-more-with-the-primary-driver-being-online-course-offerings-and-part-time-attendance.-this-is-consistent-with-the-data-plot.">More interesting is the comparison of the other 3. Those that have not attended school recently are, as expected, the older population generally. The thought was that the older population tended to go to private schools more, with the primary driver being online course offerings and part-time attendance. This is consistent with the data plot.</h4>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>